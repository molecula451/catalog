apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "common.names.fullname" . }}-config
  labels:
    {{- include "common.labels" . | nindent 4 }}
data:
  config.yml: |
    mqtt:
      # Required: host name
      host: {{ .Values.frigate.mqtt.host }}
      # Optional: port (default: shown below)
      port: {{ .Values.frigate.mqtt.port }}
      # Optional: topic prefix (default: shown below)
      # NOTE: must be unique if you are running multiple instances
      topic_prefix: frigate
      # Optional: client id (default: shown below)
      # NOTE: must be unique if you are running multiple instances
      client_id: frigate
{{- if .Values.frigate.mqtt.authenticated }}
      user: {{ .Values.frigate.mqtt.username }}
      password: {{ .Values.frigate.mqtt.password }}
      # Optional: user
      # user: mqtt_user
      # Optional: password
      # NOTE: MQTT password can be specified with an environment variables that must begin with 'FRIGATE_'.
      #       e.g. password: '{FRIGATE_MQTT_PASSWORD}'
      # password: password
{{- end }}
      stats_interval: 60

      detectors:
     #Required: name of the detector
{{- if .Values.persistence.coral }}
{{- if .Values.persistence.coral.enabled }}
      coral:
        # Required: type of the detector
        # Valid values are 'edgetpu' (requires device property below) and 'cpu'.
        type: edgetpu
        # Optional: device name as defined here: https://coral.ai/docs/edgetpu/multiple-edgetpu/#using-the-tensorflow-lite-python-api
        device: usb
{{- else }}
      cpu1:
        type: cpu
        # Optional: num_threads value passed to the tflite.Interpreter (default: shown below)
        # This value is only used for CPU types
        num_threads: 2
{{- end }}
{{- end }}